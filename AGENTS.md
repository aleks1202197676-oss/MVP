# AGENTS.md

## Source of truth
- **Единый источник истины для агента: `latest_bundle.zip`**.
- Перед выполнением задач агент должен опираться на содержимое bundle и правила этого репозитория.

## Master rules
- Поддерживаемые треки: `PR-A*`, `PR-F*`, `PR-G*`.
- Трек обязателен: любые изменения вне трекового scope запрещены.
- Preflight обязателен и выполняется до любых патчей.
- Implement выполняется только после явной preflight-проверки scope.

## Two-phase protocol
1. **Preflight first**
   - Проверить ветку, `git status`, целевой track и фактический scope.
   - Зафиксировать allowlist/denylist и команды проверки.
   - Проверить доступность сети (если в задаче есть bundle/remote/PR операции).
2. **Implement second**
   - Вносить только минимальные patch-изменения в разрешённом scope.
   - Не расширять scope без явного согласования.

## Scope guard
- Перед коммитом и перед PR обязателен `git diff --name-only`.
- Если есть путь вне allowlist или denylist нарушен — **stop/fail-fast** с коротким actionable сообщением.

## Stop conditions
- Неопределённый track или конфликт allowlist/denylist.
- Изменения выходят за согласованный scope.
- Невозможно подтвердить результаты проверок.

## Patch-first execution
- Предпочитать небольшие, проверяемые patch-изменения.
- Не добавлять placeholder-значения и заглушки (`...`, `TODO` без контекста).

## Operator-first preference
- Когда возможно, задачи/патчи оформлять через очередь `tools/operator` (task queue / handoff), чтобы снизить ручные действия и упростить передачу контекста.

## Safety
- Не добавлять новые зависимости без явной необходимости.
- Всегда указывать команды проверки и фактический результат.
